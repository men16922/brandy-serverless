# 개발자 치트시트 🚀

## ⚡ 빠른 시작 (5분 설정)

```bash
# 1. 저장소 클론 & 이동
git clone <repository>
cd brandy-serverless

# 2. 가상환경 생성 & 활성화
python3 -m venv venv
source venv/bin/activate

# 3. 개발환경 자동 설정
./scripts/activate-dev.sh

# 4. 로컬 환경 시작
./scripts/dev.sh setup

# 5. 모든 것이 잘 작동하는지 확인
./scripts/dev.sh validate

# 완료! 이제 개발 가능 🎉
```

## 🔧 일상적인 개발 명령어

### 통합 개발 스크립트 (메인)
```bash
./scripts/dev.sh setup     # 환경 설정 (Docker + 의존성)
./scripts/dev.sh validate  # 환경 검증 (모든 서비스 체크)
./scripts/dev.sh test      # 통합 테스트 실행 (29개 테스트)
./scripts/dev.sh build     # SAM 애플리케이션 빌드
./scripts/dev.sh api       # 로컬 API 서버 시작
./scripts/dev.sh app       # Streamlit 웹앱 시작
./scripts/dev.sh cleanup   # 환경 정리 (Docker 중지)
./scripts/dev.sh help      # 도움말
```

### 개별 스크립트 (세부 제어)
```bash
# 환경 관리
./scripts/activate-dev.sh               # 개발환경 활성화
./scripts/setup-local.sh                # Docker 서비스만 시작
python scripts/validate-environment.py  # 환경 전체 검증

# SAM 관련
./scripts/sam-build.sh                  # SAM 빌드
./scripts/sam-local.sh                  # 로컬 API 시작
./scripts/sam-deploy.sh dev             # AWS 개발환경 배포

# Docker 관리
docker-compose -f docker-compose.local.yml up -d    # 서비스 시작
docker-compose -f docker-compose.local.yml down -v  # 서비스 중지+정리
docker-compose -f docker-compose.local.yml ps       # 서비스 상태 확인
```

## 🌐 로컬 서비스 URL

| 서비스 | URL | 용도 | 로그인 |
|--------|-----|------|--------|
| API Gateway | http://localhost:3000 | API 테스트 | - |
| DynamoDB Admin | http://localhost:8002 | 데이터베이스 관리 | - |
| MinIO Console | http://localhost:9001 | 파일 저장소 관리 | minioadmin/minioadmin |
| Chroma API | http://localhost:8001 | 벡터 DB | - |
| Streamlit App | http://localhost:8501 | 웹 인터페이스 | - |

## 🧪 테스트 명령어

```bash
# 전체 통합 테스트 (권장)
./scripts/dev.sh test

# 개별 테스트 실행
python -m pytest tests/integration/test_workflow.py -v    # 워크플로 테스트
python -m pytest tests/integration/test_models.py -v     # 모델 테스트
python -m pytest tests/integration/ -k "test_docker" -v  # Docker 관련만

# 환경 검증 (테스트 전 필수)
python scripts/validate-environment.py

# 특정 테스트만 실행
python -m pytest tests/integration/test_workflow.py::TestDockerIntegration::test_session_workflow_with_real_storage -v
```

## 🔍 디버깅 & 문제 해결

### 자주 발생하는 문제들

#### 1. 가상환경 문제
```bash
# 증상: "command not found" 또는 "module not found"
# 해결:
echo $VIRTUAL_ENV  # 가상환경 확인
source venv/bin/activate  # 가상환경 활성화
./scripts/activate-dev.sh  # 의존성 재설치
```

#### 2. Docker 서비스 문제
```bash
# 증상: "connection refused" 또는 서비스 응답 없음
# 해결:
docker info  # Docker 실행 상태 확인
./scripts/dev.sh cleanup  # 기존 서비스 정리
./scripts/dev.sh setup    # 서비스 재시작

# 포트 충돌 확인
lsof -i :8000,8001,8002,9000,9001
```

#### 3. 테스트 실패
```bash
# 증상: 테스트가 실패하거나 멈춤
# 해결:
./scripts/dev.sh validate  # 환경 먼저 검증
docker-compose -f docker-compose.local.yml logs  # 서비스 로그 확인
./scripts/dev.sh cleanup && ./scripts/dev.sh setup  # 환경 재설정
```

#### 4. 의존성 문제
```bash
# 증상: import 에러 또는 패키지 없음
# 해결:
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

### 로그 확인 방법
```bash
# Docker 서비스 로그
docker-compose -f docker-compose.local.yml logs dynamodb-local
docker-compose -f docker-compose.local.yml logs minio
docker-compose -f docker-compose.local.yml logs chroma

# SAM Local 로그 (API 서버 실행 중일 때)
# 터미널에서 실시간 확인 가능

# AWS 배포 후 로그
sam logs --stack-name ai-branding-chatbot-dev --tail
```

## 📊 데이터 확인 방법

### DynamoDB 데이터 확인
```bash
# 1. Admin UI 접속
open http://localhost:8002

# 2. 테이블 선택: branding-chatbot-sessions-local
# 3. 세션 ID로 검색
# 4. 데이터 구조 확인:
#    - sessionId: 세션 고유 ID
#    - currentStep: 현재 진행 단계 (1-5)
#    - status: active/completed/failed
#    - businessInfo: 입력된 비즈니스 정보
#    - analysisResult: 분석 결과
#    - agentLogs: 에이전트 실행 로그
```

### MinIO 파일 확인
```bash
# 1. Console 접속
open http://localhost:9001
# 로그인: minioadmin/minioadmin

# 2. 버킷 선택: ai-branding-chatbot-assets-local
# 3. 폴더 구조:
#    - signboards/: 간판 디자인 이미지
#    - interiors/: 인테리어 이미지  
#    - reports/: PDF 보고서
#    - temp/: 임시 파일
```

## 🚀 배포 관련

### AWS 개발환경 배포
```bash
# 1. AWS 자격증명 설정 (최초 1회)
aws configure
# Access Key ID: [입력]
# Secret Access Key: [입력]  
# Default region: us-east-1
# Default output format: json

# 2. 빌드 & 배포
./scripts/sam-build.sh
./scripts/sam-deploy.sh dev

# 3. 배포 상태 확인
aws cloudformation describe-stacks --stack-name ai-branding-chatbot-dev

# 4. 로그 확인
sam logs --stack-name ai-branding-chatbot-dev --tail
```

### 프로덕션 배포
```bash
# 주의: 프로덕션 배포는 신중하게!
./scripts/sam-deploy.sh prod
```

## 📝 코드 수정 워크플로

### 새 AI 에이전트 추가
```bash
# 1. 에이전트 폴더 생성
mkdir src/lambda/agents/new-agent
cd src/lambda/agents/new-agent

# 2. 기본 파일 생성
touch index.py requirements.txt

# 3. template.yaml에 Lambda 함수 추가
# (기존 에이전트 참고하여 작성)

# 4. 테스트 작성
# tests/integration/에 테스트 추가

# 5. 빌드 & 테스트
./scripts/dev.sh build
./scripts/dev.sh test
```

### 기존 코드 수정
```bash
# 1. 코드 수정
# (에디터에서 편집)

# 2. 로컬 테스트
./scripts/dev.sh test

# 3. 로컬 API 서버에서 확인
./scripts/dev.sh api
# 브라우저에서 http://localhost:3000 테스트

# 4. 문제없으면 커밋
git add .
git commit -m "feat: 새 기능 추가"
```

## 🎯 성능 최적화 팁

### 개발 속도 향상
```bash
# 1. Docker 이미지 캐싱 활용
# 서비스를 자주 재시작하지 말고 유지

# 2. 테스트 범위 제한
python -m pytest tests/integration/test_models.py -v  # 모델만
python -m pytest tests/integration/ -k "not slow" -v  # 빠른 테스트만

# 3. SAM 빌드 캐싱
sam build --cached --parallel

# 4. 가상환경 재사용
# 매번 새로 만들지 말고 기존 것 활용
```

### 리소스 사용량 최적화
```bash
# Docker 메모리 사용량 확인
docker stats

# 불필요한 컨테이너 정리
docker system prune -f

# 로그 파일 정리
docker-compose -f docker-compose.local.yml logs --tail=100
```

## 🆘 응급 상황 대처

### 모든 것이 망가졌을 때
```bash
# 1. 완전 초기화
./scripts/dev.sh cleanup
docker system prune -af
rm -rf .aws-sam/
rm -rf venv/

# 2. 처음부터 다시 설정
python3 -m venv venv
source venv/bin/activate
./scripts/activate-dev.sh
./scripts/dev.sh setup

# 3. 검증
./scripts/dev.sh validate
```

### 특정 서비스만 문제일 때
```bash
# DynamoDB만 재시작
docker-compose -f docker-compose.local.yml restart dynamodb-local

# MinIO만 재시작  
docker-compose -f docker-compose.local.yml restart minio

# 전체 서비스 상태 확인
docker-compose -f docker-compose.local.yml ps
```

## 📚 추가 학습 자료

### 프로젝트 이해
- `프로젝트_이해_가이드.md` - 전체 프로젝트 개념 설명
- `API_사용_예시.md` - 실제 API 호출 예시
- `CLEANUP_SUMMARY.md` - 프로젝트 정리 내역

### AWS 관련
- [AWS SAM 공식 문서](https://docs.aws.amazon.com/serverless-application-model/)
- [AWS Lambda 개발자 가이드](https://docs.aws.amazon.com/lambda/latest/dg/)
- [DynamoDB 개발자 가이드](https://docs.aws.amazon.com/dynamodb/latest/developerguide/)

---

이 치트시트를 북마크해두고 개발할 때 참고하세요! 🔖